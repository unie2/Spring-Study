## âœ” ë¹ˆ ìŠ¤ì½”í”„ë€?
- ìŠ¤í”„ë§ ë¹ˆì´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ í•¨ê»˜ ìƒì„±ë˜ì–´ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ìœ ì§€ëœë‹¤.
  - ì´ê²ƒì€ ìŠ¤í”„ë§ ë¹ˆì´ ê¸°ë³¸ì ìœ¼ë¡œ `ì‹±ê¸€í†¤ ìŠ¤ì½”í”„`ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì´ë‹¤.
  - `ìŠ¤ì½”í”„` : ë¹ˆì´ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ë²”ìœ„
### 1. ìŠ¤ì½”í”„ ì¢…ë¥˜
ìŠ¤í”„ë§ì€ ë‹¤ì–‘í•œ ìŠ¤ì½”í”„ë¥¼ ì§€ì›í•œë‹¤.
- ì‹±ê¸€í†¤ : ê¸°ë³¸ ìŠ¤ì½”í”„, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ ì¢…ë£Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ê°€ì¥ ë„“ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- í”„ë¡œí† íƒ€ì… : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§€ë§Œ ê´€ì—¬í•˜ê³ , ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ë§¤ìš° ì§§ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- ì›¹ ê´€ë ¨ ìŠ¤ì½”í”„
  - request : ì›¹ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
  - session : ì›¹ ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¢…ë£Œë  ë•Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
  - application : ì›¹ì˜ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ê°™ì€ ë²”ìœ„ë¡œ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„

### 2. ë¹ˆ ìŠ¤ì½”í”„ ì§€ì • (ì‹±ê¸€í†¤)
#### ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ìë™ ë“±ë¡
````java
@Scope("prototype")
@Component
public class HelloBean {}
````
#### ìˆ˜ë™ ë“±ë¡
````java
@Scope("prototype")
@Bean
PrototypeBean HelloBean() {
    return new HelloBean();
}
````

- - -
## âœ” í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„
- ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ì¡°íšŒí•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì˜ ìŠ¤í”„ë§ ë¹ˆì„ ë°˜í™˜í•œë‹¤.
- ë°˜ë©´ì— `í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„`ë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¡°íšŒí•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í•­ìƒ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.
- í•µì‹¬ì€ ìŠ¤í”„ë§ ì»¨ì—ë‹ˆë„ˆëŠ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…, ì´ˆê¸°í™”ê¹Œì§€ë§Œ ì²˜ë¦¬í•œë‹¤ëŠ” ê²ƒì´ë‹¤.
  - í´ë¼ì´ì–¸íŠ¸ì— ë¹ˆì„ ë°˜í™˜í•˜ê³ , ì´í›„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìƒì„±ëœ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬í•  ì±…ì„ì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ë°›ì€ í´ë¼ì´ì–¸íŠ¸ì— ìˆë‹¤.
  - ê·¸ë˜ì„œ `@PreDestroy` ê°™ì€ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.

### 1. ì‹±ê¸€í†¤ ë¹ˆ ìš”ì²­
![ì‹±ê¸€í†¤ ë¹ˆ ìš”ì²­](https://user-images.githubusercontent.com/54324782/215249813-ed6fcee0-0323-42c6-b222-2cd2fa28894a.png)
```
1. ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•œë‹¤.
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ë³¸ì¸ì´ ê´€ë¦¬í•˜ëŠ” ìŠ¤í”„ë§ ë¹ˆì„ ë°˜í™˜í•œë‹¤.
3. ì´í›„ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ê°™ì€ ìš”ì²­ì´ ì™€ë„ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì˜ ìŠ¤í”„ë§ ë¹ˆì„ ë°˜í™˜í•œë‹¤.
```
#### ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ ë¹ˆ í…ŒìŠ¤íŠ¸
test > java > hello.core.scope > SingletonTest.java (class)
````java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

public class SingletonTest {
    @Test
    public void singletonBeanFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(SingletonBean.class);
        SingletonBean singletonBean1 = ac.getBean(SingletonBean.class);
        SingletonBean singletonBean2 = ac.getBean(SingletonBean.class);
        System.out.println("singletonBean1 = " + singletonBean1);
        System.out.println("singletonBean2 = " + singletonBean2);
        Assertions.assertThat(singletonBean1).isSameAs(singletonBean2);

        ac.close(); // ì¢…ë£Œ
    }

    @Scope("singleton")
    static class SingletonBean {
        @PostConstruct
        public void init() {
            System.out.println("SingletonBean.init");
        }
        @PreDestroy
        public void destroy() {
            System.out.println("SingletonBean.destroy");
        }
    }
}
````

#### ì‹¤í–‰ ê²°ê³¼
- ë¹ˆ ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³ ,
- ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì˜ ë¹ˆì„ ì¡°íšŒí•˜ê³ ,
- ì¢…ë£Œ ë©”ì„œë“œê¹Œì§€ ì •ìƒ í˜¸ì¶œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```
SingletonBean.init
singletonBean1 = hello.core.scope.SingletonTest$SingletonBean@1e097d59
singletonBean2 = hello.core.scope.SingletonTest$SingletonBean@1e097d59
15:16:13.885 [main] DEBUG org.springframework.context.annotation.AnnotationConfigApplicationContext - Closing SingletonBean.destroy
```

### 2. í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­
![í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­1](https://user-images.githubusercontent.com/54324782/215249856-c34a48df-a49d-4781-861c-5918b2fbd1b6.png)
```
1. í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•œë‹¤.
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì´ ì‹œì ì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³ , í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…í•œë‹¤.
```
![í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­2](https://user-images.githubusercontent.com/54324782/215249889-01a882bc-f94f-4500-a1be-dec61435a25e.png)
```
3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìƒì„±í•œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜í•œë‹¤.
4. ì´í›„ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ê°™ì€ ìš”ì²­ì´ ì˜¤ë©´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.
```

#### í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ ë¹ˆ í…ŒìŠ¤íŠ¸
test > java > hello.core.scope > PrototypeTest.java (class)
````java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

public class PrototypeTest {
    @Test
    public void prototypeBeanFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        System.out.println("find prototypeBean1");
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        System.out.println("find prototypeBean2");
        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
        System.out.println("prototypeBean1 = " + prototypeBean1);
        System.out.println("prototypeBean2 = " + prototypeBean2);
        Assertions.assertThat(prototypeBean1).isNotSameAs(prototypeBean2);

        ac.close(); // ì¢…ë£Œ
    }

    @Scope("prototype")
    static class PrototypeBean {
        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init");
        }
        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}
````

#### ì‹¤í–‰ ê²°ê³¼
- ì‹±ê¸€í†¤ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œì ì— ì´ˆê¸°í™” ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ì§€ë§Œ, í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ë¹ˆì„ ì¡°íšŒí•  ë•Œ ìƒì„±ë˜ê³ , ì´ˆê¸°í™” ë©”ì„œë“œë„ ì‹¤í–‰ëœë‹¤.
- í”„ë¡œí† íƒ€ì… ë¹ˆì„ 2ë²ˆ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ ì™„ì „íˆ ë‹¤ë¥¸ ìŠ¤í”„ë§ ë¹ˆì´ ìƒì„±ë˜ê³ , ì´ˆê¸°í™”ë„ 2ë²ˆ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```
find prototypeBean1
PrototypeBean.init
find prototypeBean2
PrototypeBean.init
prototypeBean1 = hello.core.scope.PrototypeTest$PrototypeBean@1e097d59
prototypeBean2 = hello.core.scope.PrototypeTest$PrototypeBean@673be18f
15:24:14.297 [main] DEBUG org.springframework.context.annotation.AnnotationConfigApplicationContext - Closing 
```
```
// ì¶”ê°€
ì‹±ê¸€í†¤ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ ë¹ˆì˜ ì¢…ë£Œ ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ì§€ë§Œ,
í”„ë¡œí† íƒ€ì… ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì… ê·¸ë¦¬ê³  ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬í•˜ê³ , ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
ë”°ë¼ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ `@PreDestroy`ê°™ì€ ì¢…ë£Œ ë©”ì„œë“œê°€ ì „í˜€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
```

### ğŸ’¡ í”„í† í† íƒ€ì… ë¹ˆì˜ íŠ¹ì§• ì •ë¦¬
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ëœë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì… ê·¸ë¦¬ê³  ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬í•œë‹¤.
- ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
- ê·¸ë˜ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì¡°íšŒí•œ í´ë¼ì´ì–¸íŠ¸ê°€ ê´€ë¦¬í•´ì•¼ í•œë‹¤. ì¢…ë£Œ ë©”ì„œë“œì— ëŒ€í•œ í˜¸ì¶œë„ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ í•´ì•¼í•œë‹¤.


- - -
## âœ” í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¬¸ì œì 
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìš”ì²­í•˜ë©´ í•­ìƒ ìƒˆë¡œìš´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.
- í•˜ì§€ë§Œ ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©í•  ë•ŒëŠ” ì˜ë„í•œ ëŒ€ë¡œ ì˜ ë™ì‘í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•œë‹¤.

### 1. í”„ë¡œí† íƒ€ì… ë¹ˆ ì§ì ‘ ìš”ì²­
#### ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆ ì§ì ‘ ìš”ì²­1
![ìš”ì²­ 1](https://user-images.githubusercontent.com/54324782/215252889-aa6ffdda-73c0-4ed5-8472-d1c34f1ce750.png)
```
1. í´ë¼ì´ì–¸íŠ¸AëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­í•œë‹¤.
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒˆë¡œ ìƒì„±í•´ì„œ ë°˜í™˜(x01)í•œë‹¤. í•´ë‹¹ ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0ì´ë‹¤.
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ í”„ë¡œí† íƒ€ì… ë¹ˆì— `addCount()` ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ count í•„ë“œë¥¼ +1 í•œë‹¤.
4. ê²°ê³¼ì ìœ¼ë¡œ í”„ë¡œí† íƒ€ì… ë¹ˆ(x01)ì˜ countëŠ” 1ì´ ëœë‹¤.
```

#### ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆ ì§ì ‘ ìš”ì²­2
![ìš”ì²­ 2](https://user-images.githubusercontent.com/54324782/215252962-55cd2a16-31af-4cc5-a64f-776915676e4e.png)
```
1. í´ë¼ì´ì–¸íŠ¸BëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­í•œë‹¤.
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒˆë¡œ ìƒì„±í•´ì„œ ë°˜í™˜(x02)í•œë‹¤. í•´ë‹¹ ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0ì´ë‹¤.
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ í”„ë¡œí† íƒ€ì… ë¹ˆì— `addCount()`ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ count í•„ë“œë¥¼ +1 í•œë‹¤.
4. ê²°ê³¼ì ìœ¼ë¡œ í”„ë¡œí† íƒ€ì… ë¹ˆ(x02)ì˜ countëŠ” 1ì´ ëœë‹¤.
```

#### ğŸ’¡ ì½”ë“œë¡œ í™•ì¸
test > java > hello.core.scope > SingletonWithPrototypeTest1.java (class)
````java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

public class SingletonWithPrototypeTest1 {
    @Test
    void prototypeFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        prototypeBean1.addCount();
        Assertions.assertThat(prototypeBean1.getCount()).isEqualTo(1);
        
        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
        prototypeBean2.addCount();
        Assertions.assertThat(prototypeBean2.getCount()).isEqualTo(1);
    }

    @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;

        public void addCount() {
            count++;
        }
        public int getCount() {
            return count;
        }

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }
        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}
````

### 2. ì‹±ê¸€í†¤ ë¹ˆì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©
- `clientBean`ì´ë¼ëŠ” ì‹±ê¸€í†¤ ë¹ˆì´ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ í†µí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì…ë°›ì•„ì„œ ì‚¬ìš©

#### ì‹±ê¸€í†¤ì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©1
clientBeanì€ ì‹±ê¸€í†¤ì´ë¯€ë¡œ, ë³´í†µ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œì ì— í•¨ê»˜ ìƒì„±ë˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ ë°œìƒí•œë‹¤.

![ì‹±ê¸€í†¤ ì‚¬ìš©1](https://user-images.githubusercontent.com/54324782/215253199-10316cc8-a3d4-488a-964f-afae2eb6c499.png)
```
1. clientBeanì€ ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì…ì„ ì‚¬ìš©í•œë‹¤. ì£¼ì… ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­í•œë‹¤.
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ clientBeanì— ë°˜í™˜í•œë‹¤. í”„ë¡œí† íƒ€ì… ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0ì´ë‹¤.
3. ì´ì œ clientBeanì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ë‚´ë¶€ í•„ë“œì— ë³´ê´€í•œë‹¤. (ì •í™•íˆëŠ” ì°¸ì¡°ê°’ì„ ë³´ê´€)
```

#### ì‹±ê¸€í†¤ì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©2
í´ë¼ì´ì–¸íŠ¸AëŠ” clientBeanì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ ë°›ëŠ”ë‹¤. ì‹±ê¸€í†¤ì´ë¯€ë¡œ í•­ìƒ ê°™ì€ clientBeanì´ ë°˜í™˜ëœë‹¤.

![ì‹±ê¸€í†¤ ì‚¬ìš©2](https://user-images.githubusercontent.com/54324782/215253300-9e178080-45ce-49f2-8958-0592bd7dbce3.png)
```
3. í´ë¼ì´ì–¸íŠ¸ AëŠ” clientBean.logic()ì„ í˜¸ì¶œí•œë‹¤.
4. clientBeanì€ prototypeBeanì˜ `addCount()`ë¥¼ í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ countë¥¼ ì¦ê°€í•œë‹¤. count ê°’ì´ 1ì´ ëœë‹¤.
```

#### ì‹±ê¸€í†¤ì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©3 
- í´ë¼ì´ì–¸íŠ¸ BëŠ” clientBeanì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ ë°›ëŠ”ë‹¤. ì‹±ê¸€í†¤ì´ë¯€ë¡œ í•­ìƒ ê°™ì€ clientBeanì´ ë°˜í™˜ëœë‹¤.
- ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì´ ìˆëŠ”ë°, clientBeanì´ ë‚´ë¶€ì— ê°€ì§€ê³  ìˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì€ ì´ë¯¸ ê³¼ê±°ì— ì£¼ì…ì´ ëë‚œ ë¹ˆì´ë‹¤.
  ì£¼ì… ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒˆë¡œ ìƒì„±ì´ ëœ ê²ƒì´ì§€, ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.

![ì‹±ê¸€í†¤ ì‚¬ìš©3](https://user-images.githubusercontent.com/54324782/215253368-a8d23b1d-80ea-4f46-b5c1-966969b6da8a.png)
```
5. í´ë¼ì´ì–¸íŠ¸ BëŠ” clientBean.logic()ì„ í˜¸ì¶œí•œë‹¤.
6. clientBeanì€ prototypeBeanì˜ `addCount()`ë¥¼ í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ countë¥¼ ì¦ê°€í•œë‹¤. ì›ë˜ count ê°’ì´ 1ì´ì—ˆìœ¼ë¯€ë¡œ 2ê°€ ëœë‹¤.
```

#### ğŸ’¡ í…ŒìŠ¤íŠ¸ ì½”ë“œ
test > java > hello.core.scope > SingletonWithPrototypeTest1.java
````java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

public class SingletonWithPrototypeTest1 {
    @Test
    void prototypeFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);
        ClientBean clientBean1 = ac.getBean(ClientBean.class);
        int count1 = clientBean1.logic();
        Assertions.assertThat(count1).isEqualTo(1);

        ClientBean clientBean2 = ac.getBean(ClientBean.class);
        int count2 = clientBean2.logic();
        Assertions.assertThat(count2).isEqualTo(2);
    }

    @Scope("singleton")
    static class ClientBean {
        private final PrototypeBean prototypeBean;

        @Autowired
        public ClientBean(PrototypeBean prototypeBean) {
            this.prototypeBean = prototypeBean;
        }

        public int logic() {
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }
    }

    @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;

        public void addCount() {
            count++;
        }
        public int getCount() {
            return count;
        }

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }
        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}
````

- ìŠ¤í”„ë§ì€ ì¼ë°˜ì ìœ¼ë¡œ ì‹±ê¸€í†¤ ë¹ˆì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ì‹±ê¸€í†¤ ë¹ˆì´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
- í•˜ì§€ë§Œ ì‹±ê¸€í†¤ ë¹ˆì€ ìƒì„± ì‹œì ì—ë§Œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ ë°›ê¸° ë•Œë¬¸ì—, í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒˆë¡œ ìƒì„±ë˜ê¸°ëŠ” í•˜ì§€ë§Œ, ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ê³„ì† ìœ ì§€ë˜ëŠ” ê²ƒì´ ë¬¸ì œë‹¤.

```
// ì°¸ê³ 
ì—¬ëŸ¬ ë¹ˆì—ì„œ ê°™ì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì… ë°›ìœ¼ë©´, ì£¼ì… ë°›ëŠ” ì‹œì ì— ê°ê° ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±ëœë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ì„œ clientA, clientBê°€ ê°ê° ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ ë°›ìœ¼ë©´ ê°ê° ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì˜ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì… ë°›ëŠ”ë‹¤.
clientA -> prototypeBean@x01
clientB -> prototypeBean@x02
ë¬¼ë¡  ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.
```


- - -
## âœ” í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ Providerë¡œ ë¬¸ì œ í•´ê²°
ì‹±ê¸€í†¤ ë¹ˆê³¼ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ, í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ëŠ” ë°©ë²•
- ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ ì‹±ê¸€í†¤ ë¹ˆì´ í”„ë¡œí† íƒ€ì…ì„ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ `ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìƒˆë¡œ ìš”ì²­`í•˜ëŠ” ê²ƒ

### 1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­
test > java > hello.core.scope > SingletonWithPrototypeTest1.java
````java
@Scope("singleton")
static class ClientBean {
    private ApplicationContext ac;

    public int logic() {
        PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);
        prototypeBean.addCount();
        int count = prototypeBean.getCount();
        return count;
    }
}
````
```
- `ac.getBean()`ì„ í†µí•´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±
- ì˜ì¡´ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…(DI)ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì´ë ‡ê²Œ ì§ì ‘ í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì°¾ëŠ” ê²ƒì„ `Dependency Lookup(DL) ì˜ì¡´ê´€ê³„ ì¡°íšŒ(íƒìƒ‰)` ì´ë¼ í•œë‹¤.
- í•˜ì§€ë§Œ, ì´ë ‡ê²Œ ìŠ¤í”„ë§ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ì „ì²´ë¥¼ ì£¼ì…ë°›ê²Œ ë˜ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¢…ì†ì ì¸ ì½”ë“œê°€ ë˜ê³ , ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë„ ì–´ë ¤ì›Œì§„ë‹¤.
- ì§€ê¸ˆ í•„ìš”í•œ ê¸°ëŠ¥ì€ ì§€ì •í•œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì»¨í…Œì´ë„ˆì—ì„œ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” ë”± `DL` ì •ë„ì˜ ê¸°ëŠ¥ë§Œ ì œê³µí•˜ëŠ” ìš”ì†Œì´ë‹¤.
```

### ğŸ’¡ [ë°©ë²•1] ObjectFactory, ObjectProvider
- `ObjectProvider` : ì§€ì •í•œ ë¹ˆì„ ì»¨í…Œì´ë„ˆì—ì„œ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” DL ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê²ƒ
- ê³¼ê±°ì—ëŠ” `ObjectFactory`ê°€ ìˆì—ˆëŠ”ë°, í¸ì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•œ `ObjectProvider`ê°€ ë§Œë“¤ì–´ì¡Œë‹¤.

test > java > hello.core.scope > SingletonWithPrototypeTest1.java
````java
@Scope("singleton")
static class ClientBean {
    private ObjectProvider<PrototypeBean> prototypeBeanProvider;

    public int logic() {
        PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
        prototypeBean.addCount();
        int count = prototypeBean.getCount();
        return count;
    }
}
````
```
- `prototypeBeanProvider.getObject()`ë¥¼ í†µí•´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±
- `ObjectProvider`ì˜ `getObject()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆì„ ì°¾ì•„ì„œ ë°˜í™˜í•œë‹¤. __(DL)__
- ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ mock ì½”ë“œë¥¼ ë§Œë“¤ê¸°ëŠ” í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤.
- `ObjectProvider`ëŠ” ì§€ê¸ˆ ë”± í•„ìš”í•œ DL ì •ë„ì˜ ê¸°ëŠ¥ë§Œ ì œê³µ
```

#### íŠ¹ì§•
```
- ObjectFactory: ê¸°ëŠ¥ì´ ë‹¨ìˆœ, ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´
- ObjectProvider: ObjectFacotry ìƒì†, ì˜µì…˜, ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ ë“± í¸ì˜ ê¸°ëŠ¥ì´ ë§ê³ , ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´
```
### ğŸ’¡ [ë°©ë²•2] JSR-330 Provider
- `javax.inject.Provider` ë¼ëŠ” JSR-330 ìë°” í‘œì¤€ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
- `javax.inject:javax.inject:1` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ gradleì— ì¶”ê°€í•´ì•¼ í•œë‹¤.

````java
// javax.inject.Provider ì°¸ê³ ìš© ì½”ë“œ
package javax.inject;
public interface Provider<T> {
    T get();
}
````

build.gradle
````gradle
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter'
	implementation 'javax.inject:javax.inject:1'
  .
  .
}
````

test > java > hello.core.scope > SingletonWithPrototypeTest1.java
````java
import javax.inject.Provider;
.
.
public class SingletonWithPrototypeTest1 {
    .
    .
    @Scope("singleton")
    static class ClientBean {
        private Provider<PrototypeBean> provider;
        public int logic() {
            PrototypeBean prototypeBean = provider.get();
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }
    }
}
````
```
- `provider.get()`ì„ ã…—ã…Œã…‡í•´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±
- providerì˜ `get()`ì„ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆì„ ì°¾ì•„ì„œ ë°˜í™˜í•œë‹¤. (DL)
- ìë°” í‘œì¤€ì´ê³ , ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ mock ì½”ë“œë¥¼ ë§Œë“¤ê¸°ëŠ” í›¨ì‹  ì‰¬ì›Œì§„ë‹¤.
- `Provider`ëŠ” ì§€ê¸ˆ ë”± í•„ìš”í•œ DL ì •ë„ì˜ ê¸°ëŠ¥ë§Œ 
```

#### íŠ¹ì§•
```
- `get()` ë©”ì„œë“œ í•˜ë‚˜ë¡œ ê¸°ëŠ¥ì´ ë§¤ìš° ë‹¨ìˆœí•˜ë‹¤.
- ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë‹¤.
- ìë°” í‘œì¤€ì´ë¯€ë¡œ ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```

### ğŸ’¡ ì •ë¦¬
- í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì–¸ì œ ì‚¬ìš©?
  - ë§¤ë²ˆ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œëœ ìƒˆë¡œìš´ ê°ì²´ê°€ í•„ìš”í•˜ë©´ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
  - í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ì‹±ê¸€í†¤ ë¹ˆìœ¼ë¡œ ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì¼ì€ ë§¤ìš° ë“œë¬¼ë‹¤.
- `ObjectProvider`, `JSR330 Provider` ë“±ì€ í”„ë¡œí† íƒ€ì… ë¿ë§Œ ì•„ë‹ˆë¼ DLì´ í•„ìš”í•œ ê²½ìš°ëŠ” ì–¸ì œë“ ì§€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```
// ì°¸ê³ 
ì‹¤ë¬´ì—ì„œ ìë°” í‘œì¤€ì¸ JSR-330 Providerë¥¼ ì‚¬ìš©í•  ê²ƒì¸ì§€, ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ObjectProviderë¥¼ ì‚¬ìš©í•  ê²ƒì¸ì§€ ê³ ë¯¼?
- ObjectProviderëŠ” DLì„ ìœ„í•œ í¸ì˜ ê¸°ëŠ¥ì„ ë§ì´ ì œê³µí•´ì£¼ê³  ìŠ¤í”„ë§ ì™¸ì— ë³„ë„ì˜ ì˜ì¡´ê´€ê³„ ì¶”ê°€ê°€ í•„ìš” ì—†ì´ ë•Œë¬¸ì— í¸ë¦¬í•˜ë‹¤.
- ë§Œì•½ ì½”ë“œë¥¼ ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ë©´ JSR-330 Providerë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
```

- - -
## âœ” ì›¹ ìŠ¤ì½”í”„
```
// ì‹±ê¸€í†¤ê³¼ í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ ì •ë¦¬
- ì‹±ê¸€í†¤ : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ ëê¹Œì§€ í•¨ê»˜í•˜ëŠ” ë§¤ìš° ê¸´ ìŠ¤ì½”í”„
- í”„ë¡œí† íƒ€ì… : ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì…, ê·¸ë¦¬ê³  ì´ˆê¸°í™”ê¹Œì§€ë§Œ ì§„í–‰í•˜ëŠ” íŠ¹ë³„í•œ ìŠ¤ì½”í”„
```
### 1. ì›¹ ìŠ¤ì½”í”„ì˜ íŠ¹ì§•
- ì›¹ ìŠ¤ì½”í”„ëŠ” ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘
- ì›¹ ìŠ¤ì½”í”„ëŠ” í”„ë¡œí† íƒ€ì…ê³¼ ë‹¤ë¥´ê²Œ ìŠ¤í”„ë§ì´ í•´ë‹¹ ìŠ¤ì½”í”„ì˜ ì¢…ë£Œì‹œì ê¹Œì§€ ê´€ë¦¬
  - ë”°ë¼ì„œ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.

### 2. ì›¹ ìŠ¤ì½”í”„ ì¢…ë¥˜
| ì¢…ë¥˜ | ì„¤ëª… |
|:--------|:--------|
| request | HTTP ìš”ì²­ í•˜ë‚˜ê°€ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„. <br>ê°ê°ì˜ HTTP ìš”ì²­ë§ˆë‹¤ ë³„ë„ì˜ ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê³ , ê´€ë¦¬ëœë‹¤. |
| session | HTTP Sessionê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„ |
| application | ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸(`ServletContext`)ì™€ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„ |
| websocket | ì›¹ ì†Œì¼“ê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„ |

#### ğŸ’¡ HTTP request ìš”ì²­ ë‹¹ ê°ê° í• ë‹¹ë˜ëŠ” request ìŠ¤ì½”í”„
![image](https://user-images.githubusercontent.com/54324782/215780067-a27f2867-7d99-4d78-80bc-58f1f356997a.png)


- - -
## âœ” request ìŠ¤ì½”í”„ ì˜ˆì œ ë§Œë“¤ê¸°
### 1. ì›¹ í™˜ê²½ ì¶”ê°€
- ì¶”ê°€ í›„ `hello.core.CoreApplication`ì˜ main ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ë§Œì•½ ê¸°ë³¸ í¬íŠ¸ì¸ 8080 í¬íŠ¸ë¥¼ ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš©ì¤‘ì´ì–´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ `main/resources/application.properties`ì—ì„œ í¬íŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½í•œë‹¤.
  - `server.port=9090`
build.gradle
```gradle
// web ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
implementation 'org.springframework.boot:spring-boot-starter-web'
```
```
// ì°¸ê³  1
`spring-boot-starter-web` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ë‚´ì¥ í†°ìº£ ì„œë²„ë¥¼ í™œìš©í•´ì„œ ì›¹ ì„œë²„ì™€ ìŠ¤í”„ë§ì„ í•¨ê»˜ ì‹¤í–‰ì‹œí‚¨ë‹¤.

// ì°¸ê³  2
ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ì›¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ìœ¼ë©´ `AnnotationConfigApplicationContext`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™í•œë‹¤.
ì›¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ë©´ ì›¹ê³¼ ê´€ë ¨ëœ ì¶”ê°€ ì„¤ì •ê³¼ í™˜ê²½ë“¤ì´ í•„ìš”í•˜ë¯€ë¡œ
`AnnotationConfigServletWebServerApplicationContext`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™í•œë‹¤.
```

### 2. request ìŠ¤ì½”í”„ ì˜ˆì œ ê°œë°œ
- ë™ì‹œì— ì—¬ëŸ¬ HTTP ìš”ì²­ì´ ì˜¤ë©´ ì •í™•íˆ ì–´ë–¤ ìš”ì²­ì´ ë‚¨ê¸´ ë¡œê·¸ì¸ì§€ êµ¬ë¶„í•˜ê¸° ì–´ë µë‹¤.
- ì´ëŸ´ ë•Œ `request ìŠ¤ì½”í”„`ë¥¼ ì‚¬ìš©í•˜ê¸° ì¢‹ë‹¤.

- ê¸°ëŒ€í•˜ëŠ” ê³µí†µ í¬ë©§ : [UUID][requestURL] {message}
- UUIDë¥¼ ì‚¬ìš©í•´ì„œ HTTP ìš”ì²­ì„ êµ¬ë¶„

```
// ì˜ˆìƒ ë¡œê·¸
[d06b992f...] request scope bean create
[d06b992f...][http://localhost:8080/log-demo] controller test
[d06b992f...][http://localhost:8080/log-demo] service id = testId
[d06b992f...] request scope bean close
```
#### (1) ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•œ MyLogger.java ìƒì„±
hello.core.common > MyLogger.java (class)
```java
package hello.core.common;

import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;
import java.util.UUID;

@Component
@Scope(value = "request")
public class MyLogger {
    private String uuid;
    private String requestURL;
    
    public void setRequestURL(String requestURL) {
        this.requestURL = requestURL;
    }
    
    public void log(String message) {
        System.out.println("[" + uuid + "][" + requestURL + "] " + message);
    }
    
    @PostConstruct
    public void init() {
        uuid = UUID.randomUUID().toString();
        System.out.println("[" + uuid + "] request scope bean create: " + this);
    }
    @PreDestroy
    public void close() {
        System.out.println("[" + uuid + "] request scope bean close: " + this);
    }
}
```
- `@Scope(value = "request")`ë¥¼ ì‚¬ìš©í•´ì„œ request ìŠ¤ì½”í”„ë¡œ ì§€ì •
  - ì´ì œ ì´ ë¹ˆì€ HTTP ìš”ì²­ë‹¹ í•˜ë‚˜ì”© ìƒì„±ë˜ê³ , HTTP ìš”ì²­ì´ ëë‚˜ëŠ” ì‹œì ì— ì†Œë©¸ëœë‹¤.
- ì´ ë¹ˆì´ ìƒì„±ë˜ëŠ” ì‹œì ì— ìë™ìœ¼ë¡œ `@PostConstruct` ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ uuidë¥¼ ìƒì„±í•´ì„œ ì €ì¥
  - ì´ ë¹ˆì€ HTTP ìš”ì²­ë‹¹ í•˜ë‚˜ì”© ìƒì„±ë˜ë¯€ë¡œ, uuidë¥¼ ì €ì¥í•´ë‘ë©´ ë‹¤ë¥¸ HTTP ìš”ì²­ê³¼ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.
- ì´ ë¹ˆì´ ì†Œë©¸ë˜ëŠ” ì‹œì ì— `@PreDestroy`ë¥¼ ì‚¬ìš©í•´ì„œ ì¢…ë£Œ ë©”ì‹œì§€ë¥¼ ë‚¨ê¸´ë‹¤.
- `requestURL`ì€ ì´ ë¹ˆì´ ìƒì„±ë˜ëŠ” ì‹œì ì—ëŠ” ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì™¸ë¶€ì—ì„œ setterë¡œ ì…ë ¥ ë°›ëŠ”ë‹¤.

#### (2) LogDemoController.java ì¶”ê°€
hello.core.web > LogDemoController.java (class)
```java
package hello.core.web;

import hello.core.common.MyLogger;
import hello.core.logdemo.LogDemoService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.servlet.http.HttpServletRequest;

@Controller
@RequiredArgsConstructor
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final MyLogger myLogger;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURI().toString();
        myLogger.setRequestURL(requestURL);

        myLogger.log("controller test");
        logDemoService.logic("testId");
        return "OK";
    }
}
```
- HttpServletRequestë¥¼ í†µí•´ì„œ ìš”ì²­ URLì„ ë°›ëŠ”ë‹¤.
  - requestURL ê°’: `http://localhost:8080/log-demo`
- ì´ë ‡ê²Œ ë°›ì€ requestURL ê°’ì„ myLoggerì— ì €ì¥í•´ë‘”ë‹¤.
  - myLoggerëŠ” HTTP ìš”ì²­ ë‹¹ ê°ê° êµ¬ë¶„ë˜ë¯€ë¡œ ë‹¤ë¥¸ HTTP ìš”ì²­ ë•Œë¬¸ì— ê°’ì´ ì„ì´ì§€ ì•ŠëŠ”ë‹¤.
- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ controller test ë¼ëŠ” ë¡œê·¸ë¥¼ ë‚¨ê¸´ë‹¤.

```
// ì°¸ê³ 
requestURLì„ MyLoggerì— ì €ì¥í•˜ëŠ” ë¶€ë¶„ì€ ì»¨íŠ¸ë¡¤ëŸ¬ ë³´ë‹¤ëŠ” ê³µí†µ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•œ `ìŠ¤í”„ë§ ì¸í„°ì…‰í„°`ë‚˜ `ì„œë¸”ë¦¿ í•„í„°` ê°™ì€ ê³³ì„ í™œìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
```

#### (3) LogDemoService.java ì¶”ê°€
hello.core.logdemo > LogDemoService.java (class)
```java
package hello.core.logdemo;

import hello.core.common.MyLogger;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final MyLogger myLogger;

    public void logic(String id) {
        myLogger.log("service id = " + id);
    }
}
```
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µ
- request scopeë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  íŒŒë¼ë¯¸í„°ë¡œ ì´ ëª¨ë“  ì •ë³´ë¥¼ ì„œë¹„ìŠ¤ ê³„ì¸µì— ë„˜ê¸´ë‹¤ë©´, íŒŒë¼ë¯¸í„°ê°€ ë§ì•„ì„œ ì§€ì €ë¶„í•´ì§„ë‹¤.
  ë” ë¬¸ì œëŠ” requestURL ê°™ì€ ì›¹ê³¼ ê´€ë ¨ëœ ì •ë³´ê°€ ì›¹ê³¼ ê´€ë ¨ì—†ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µê¹Œì§€ ë„˜ì–´ê°€ê²Œ ëœë‹¤. ì›¹ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì€ ì»¨íŠ¸ë¡¤ëŸ¬ê¹Œì§€ë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
  ì„œë¹„ìŠ¤ ê³„ì¸µì€ ì›¹ ê¸°ìˆ ì— ì¢…ì†ë˜ì§€ ì•Šê³ , ê°€ê¸‰ì  ìˆœìˆ˜í•˜ê¸° ìœ ì§€í•˜ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ ì¢‹ë‹¤.
- request scopeì˜ MyLogger ë•ë¶„ì— ì´ëŸ° ë¶€ë¶„ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸°ì§€ ì•Šê³ , MyLoggerì˜ ë©¤ë²„ë³€ìˆ˜ì— ì €ì¥í•´ì„œ ì½”ë“œì™€ ê³„ì¸µì„ ê¹”ë”í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.

#### ğŸ’¡ ê¸°ëŒ€í•˜ëŠ” ì¶œë ¥ & ì‹¤ì œ ì¶œë ¥(ì˜¤ë¥˜ ë°œìƒ)
```
// ê¸°ëŒ€í•˜ëŠ” ì¶œë ¥
[d06b992f...] request scope bean create
[d06b992f...][http://localhost:8080/log-demo] controller test
[d06b992f...][http://localhost:8080/log-demo] service id = testId
[d06b992f...] request scope bean close

// ì‹¤ì œ ì¶œë ¥(ì˜¤ë¥˜ ë°œìƒ)
Error creating bean with name 'myLogger': Scope 'request' is not active for the
current thread; consider defining a scoped proxy for this bean if you intend to
refer to it from a singleton;
// ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ì‹œì ì— ì‹±ê¸€í†¤ ë¹ˆì€ ìƒì„±í•´ì„œ ì£¼ì…ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, request ìŠ¤ì½”í”„ ë¹ˆì€ ì•„ì§ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.
// ì´ ë¹ˆì€ ì‹¤ì œ ê³ ê°ì˜ ìš”ì²­ì´ ì™€ì•¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
```

- - -
## âœ” ìŠ¤ì½”í”„ì™€ Provider
### 1. í•´ê²° ë°©ë²• 1 - Provider ì‚¬ìš©
hello.core.web.LogDemoController.java
```java
package hello.core.web;

import hello.core.common.MyLogger;
import hello.core.logdemo.LogDemoService;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.servlet.http.HttpServletRequest;

@Controller
@RequiredArgsConstructor
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final ObjectProvider<MyLogger> myLoggerProvider;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURI().toString();
        MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.setRequestURL(requestURL);

        myLogger.log("controller test");
        logDemoService.logic("testId");
        return "OK";
    }
}
```

hello.core.logdemo > LogDemoService.java
```java
package hello.core.logdemo;

import hello.core.common.MyLogger;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class LogDemoService {
    private final ObjectProvider<MyLogger> myLoggerProvider;

    public void logic(String id) {
        MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.log("service id = " + id);
    }
}
```
#### ğŸ’¡ main() ì‹¤í–‰ í›„ ë¡œê·¸ í™•ì¸
- ì›¹ ë¸Œë¼ìš°ì €ì— `http://localhost:8080/log-demo` ì…ë ¥

| ë¡œê·¸ | ì›¹ ë¸Œë¼ìš°ì € |
|:--------|:--------|
| [ef3fd906-d385-4156-83f1-05110e25fbf7] request scope bean create: hello.core.common.MyLogger@1127c86 <br>[ef3fd906-d385-4156-83f1-05110e25fbf7][/log-demo] controller test <br>[ef3fd906-d385-4156-83f1-05110e25fbf7][/log-demo] service id = testId <br>[ef3fd906-d385-4156-83f1-05110e25fbf7] request scope bean close: hello.core.common.MyLogger@1127c86 | ![image](https://user-images.githubusercontent.com/54324782/216625563-8540c9f4-3cbe-4eb7-a1f7-f63e3c224d0e.png) 

- `ObjectProvider` ë•ë¶„ì— `ObjectProvider.getObject()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ê¹Œì§€ request scope `ë¹ˆì˜ ìƒì„±ì„ ì§€ì—°`í•  ìˆ˜ ìˆë‹¤.
- `ObjectProvider.getObject()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ì—ëŠ” HTTP ìš”ì²­ì´ ì§„í–‰ì¤‘ì´ë¯€ë¡œ request scope ë¹ˆì˜ ìƒì„±ì´ ì •ìƒ ì²˜ë¦¬ëœë‹¤.
- `ObjectProvider.getObject()`ë¥¼ `LogDemoController`, `LogDemoService`ì—ì„œ ê°ê° í•œë²ˆì”© ë”°ë¡œ í˜¸ì¶œí•´ë„ ê°™ì€ HTTP ìš”ì²­ì´ë©´ ê°™ì€ ìŠ¤í”„ë§ ë¹ˆì´ ë°˜í™˜ëœë‹¤.


- - -
