## âœ” ìƒˆë¡œìš´ í• ì¸ ì •ì±… ê°œë°œ
- í• ì¸ ì •ì±…ì„ ê³ ì • ê¸ˆì•¡ í• ì¸ì´ ì•„ë‹ˆë¼ ì¢€ ë” í•©ë¦¬ì ì¸ ì£¼ë¬¸ ê¸ˆì•¡ë‹¹ í• ì¸í•˜ëŠ” `ì •ë¥ % í• ì¸`ìœ¼ë¡œ ë³€ê²½í•  ê²½ìš°
  - ex. 10%ë¡œ ì§€ì •í•  ê²½ìš° ê³ ê°ì´ 10,000ì› ì£¼ë¬¸ ì‹œ 1,000ì›ì„ í• ì¸, 20,000ì› ì£¼ë¬¸ ì‹œ 2,000ì› í• ì¸

### 1. ì •ë¥  í• ì¸ ì •ì±… ì¶”ê°€
hello.core.discount > RateDiscountPolicy.java (class)
````java
package hello.core.discount;

import hello.core.member.Grade;
import hello.core.member.Member;

public class RateDiscountPolicy implements DiscountPolicy {
    
    private int discountPercent = 10; // 10% í• ì¸

    @Override
    public int discount(Member member, int price) {
        if (member.getGrade() == Grade.VIP) {
            return price * discountPercent / 100;
        } else {
            return 0;
        }
    }
}
````

### 2. í…ŒìŠ¤íŠ¸ ì‘ì„±
test > java > hello.core.discount > RateDiscountPolicyTest.java (class)
````java
package hello.core.discount;

import hello.core.member.Grade;
import hello.core.member.Member;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

class RateDiscountPolicyTest {
    RateDiscountPolicy discountPolicy = new RateDiscountPolicy();

    @Test // ì„±ê³µ í…ŒìŠ¤íŠ¸
    @DisplayName("VIPëŠ” 10% í• ì¸ì´ ì ìš©ë˜ì–´ì•¼ í•œë‹¤")
    void vip_o() {
        // given
        Member member = new Member(1L, "memberVIP", Grade.VIP);
        // when
        int discount = discountPolicy.discount(member, 10000);
        // then
        Assertions.assertThat(discount).isEqualTo(1000);
    }

    @Test // ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸
    @DisplayName("VIPê°€ ì•„ë‹ˆë©´ í• ì¸ì´ ì ìš©ë˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.")
    void vip_x() {
        // given
        Member member = new Member(1L, "memberBASIC", Grade.BASIC);
        // when
        int discount = discountPolicy.discount(member, 10000);
        // then
        Assertions.assertThat(discount).isEqualTo(1000);
        // ë“±ê¸‰ì´ BASICì´ë¯€ë¡œ í• ì¸ê¸ˆì•¡ì€ 0ì›ì´ ë˜ì–´ì•¼ í•œë‹¤.
    }
}
````

### 3. ê²°ê³¼
| vip_o | vip_x |
|:--------:|:--------:|
| Tests passed<br>![image](https://user-images.githubusercontent.com/54324782/209412967-5bbe5b3a-36d1-4bdc-bf90-5a1db0415f3a.png) | Tests failed<br>![image](https://user-images.githubusercontent.com/54324782/209413003-7b9d645a-695f-46b1-9dd3-8342566ccb2f.png)

- - -
## âœ” ìƒˆë¡œìš´ í• ì¸ ì •ì±… ì ìš©ê³¼ ë¬¸ì œì 
- í• ì¸ ì •ì±… ë³€ê²½ì„ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ì¸ `OrderServiceImpl` ì½”ë“œë¥¼ ìˆ˜ì •
````java
public class OrderServiceImpl implements OrderService {
    // private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
}
````

### 1. ë¬¸ì œì  ë°œê²¬
- ì—­í• ê³¼ êµ¬í˜„ì„ ì¶©ì‹¤í•˜ê²Œ ë¶„ë¦¬ --> OK
- ë‹¤í˜•ì„±ë„ í™œìš©í•˜ê³ , ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ ê°ì²´ë¥¼ ë¶„ë¦¬ --> OK
- OCP, DIP ê°™ì€ ê°ì²´ì§€í–¥ ì„¤ê³„ ì›ì¹™ì„ ì¶œì‹¤í•´ ì¤€ìˆ˜ --> __X__
  - DIP ìœ„ë°˜ : êµ¬ì²´í™”ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ì¶”ìƒí™”ì— ì˜ì¡´í•´ì•¼ í•˜ëŠ”ë°, ë‘˜ ë‹¤ ì˜ì¡´
```
- ì¶”ìƒ(ì¸í„°í˜ì´ìŠ¤) ì˜ì¡´ : DiscountPolicy
- êµ¬ì²´(êµ¬í˜„) í´ë˜ìŠ¤ : FixDiscountPolicy, RateDiscountPolicy
```
  - OCP ìœ„ë°˜ : í˜„ì¬ ì½”ë“œëŠ” ê¸°ëŠ¥ì„ í™•ì¥í•´ì„œ ë³€ê²½í•˜ë©´, í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ì˜í–¥ì„ ì¤€ë‹¤.
    - ì¦‰, `FixDiscountPolicy`ë¥¼ `RateDiscountPolicy`ë¡œ ë³€ê²½í•˜ëŠ” ìˆœê°„ `OrderServiceImpl`ì˜ ì†ŒìŠ¤ ì½”ë“œë„ í•¨ê»˜ ë³€ê²½í•´ì•¼ í•œë‹¤.

### 2. ì–´ë–»ê²Œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œ?
- DIPë¥¼ ìœ„ë°˜í•˜ì§€ ì•Šë„ë¡ ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ë„ë¡ ì˜ì¡´ê´€ê³„ë¥¼ ë³€ê²½
````java
public class OrderServiceImpl implements OrderService {
    // private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
    private DiscountPolicy discountPolicy;
}
````

- í•˜ì§€ë§Œ ì‹¤ì œ ì‹¤í–‰ì„ í•´ë³´ë©´ `NPE(Null Pointer Exception)`ê°€ ë°œìƒ !!!

### ğŸ’¡ í•´ê²° ë°©ì•ˆ
ëˆ„êµ°ê°€ê°€ í´ë¼ì´ì–¸íŠ¸ì¸ OrderServiceImplì— `DiscountPolicyì˜ êµ¬í˜„ ê°ì²´ë¥¼ ëŒ€ì‹  ìƒì„±í•˜ê³  ì£¼ì…`í•´ì£¼ì–´ì•¼ í•œë‹¤.

- - -
## âœ” ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
### 1. AppConfig ë“±ì¥
- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì „ì²´ ë™ì‘ ë°©ì‹ì„ êµ¬ì„±(config)í•˜ê¸° ìœ„í•´, `êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±`í•˜ê³  `ì—°ê²°`í•˜ëŠ” ì±…ì„ì„ ê°€ì§€ëŠ” ë³„ë„ì˜ ì„¤ì • í´ë˜ìŠ¤ ìƒì„±
hello.core > AppConfig.java (class)
````java
package hello.core;

import hello.core.discount.FixDiscountPolicy;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.member.MemoryMemberRepository;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;

public class AppConfig {
    
    public MemberService memberService() {
        return new MemberServiceImpl(new MemoryMemberRepository());
    }
    
    public OrderService orderService() {
        return new OrderServiceImpl(new MemoryMemberRepository(), new FixDiscountPolicy());
    }
}
````
- AppConfigëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤ì œ ë™ì‘ì— í•„ìš”í•œ `êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±`
  - MemberServiceImpl, MemoryMemberRepository, OrderServiceImpl, FixDiscountPolicy
- AppConfigëŠ” ìƒì„±í•œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì˜ ì°¸ì¡°(ë ˆí¼ëŸ°ìŠ¤)ë¥¼ `ìƒì„±ìë¥¼ í†µí•´ì„œ ì£¼ì…(ì—°ê²°)`í•´ì¤€ë‹¤.
  - MemberServiceImpl --> MemoryMemberRepository
  - OrderServiceImpl --> MemoryMemberRepository, FixDiscountPolicy

### 2. ìƒì„±ì ì£¼ì… - MemberServiceImpl
hello.core.member > MemberServiceImpl.java (class)
````java
package hello.core.member;

public class MemberServiceImpl implements MemberService {

    private final MemberRepository memberRepository;

    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
````
- ì„¤ê³„ ë³€ê²½ìœ¼ë¡œ `MemberServiceImpl`ì€ `MemoryMemberRepository`ë¥¼ ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë‹¨ì§€ `MemberRepository` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´
- `MemberServiceImpl` ì…ì¥ì—ì„œ ìƒì„±ìë¥¼ í†µí•´ ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ë“¤ì–´ì˜¬ì§€(ì£¼ì…ë ì§€)ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤.
- `MemberServiceImpl`ì˜ ìƒì„±ìë¥¼ í†µí•´ì„œ ì–´ë–¤ êµ¬í˜„ ê°ì²´ë¥¼ ì£¼ì…í• ì§€ëŠ” ì˜¤ì§ ì™¸ë¶€(`AppConfig`)ì—ì„œ ê²°ì •ëœë‹¤.
- `MemberServiceImpl`ì€ ì´ì œë¶€í„° `ì˜ì¡´ê´€ê³„ì— ëŒ€í•œ ê³ ë¯¼ì€ ì™¸ë¶€`ì— ë§¡ê¸°ê³ , `ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘`í•˜ë©´ ëœë‹¤.

### ğŸ’¡ í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
![í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](https://user-images.githubusercontent.com/54324782/209415762-deeb435c-feec-4389-872c-70254d8795a9.png)

- ê°ì²´ì˜ ìƒì„±ê³¼ ì—°ê²°ì€ `AppConfig`ê°€ ë‹´ë‹¹
- `DIP ì™„ì„±` : MemberServiceImplì€ MemberRepositoryì¸ ì¶”ìƒì—ë§Œ ì˜ì¡´í•˜ë©´ ë˜ë¯€ë¡œ, êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ëª°ë¼ë„ ëœë‹¤.
- `ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬` : ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì—°ê²°í•˜ëŠ” ì—­í• ê³¼ ì‹¤í–‰í•˜ëŠ” ì—­í• ì´ ëª…í™•íˆ ë¶„ë¦¬ë¨

### ğŸ’¡ íšŒì› ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
![íšŒì› ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](https://user-images.githubusercontent.com/54324782/209416012-f9902087-05fe-47c9-8166-2e1ac6367762.png)

- AppConfig ê°ì²´ëŠ” memoryMemberRepository ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê·¸ ì°¸ì¡°ê°’ì„ memberServiceImplì„ ìƒì„±í•˜ë©´ì„œ ìƒì„±ìë¡œ ì „ë‹¬
- í´ë¼ì´ì–¸íŠ¸ì¸ memberServiceImpl ì…ì¥ì—ì„œ ë³´ë©´ ì˜ì¡´ê´€ê³„ë¥¼ ë§ˆì¹˜ `ì™¸ë¶€ì—ì„œ ì£¼ì…`í•´ì£¼ëŠ” ê²ƒ ê°™ë‹¤ê³  í•´ì„œ
  `ì˜ì¡´ê´€ê³„ ì£¼ì… ë˜ëŠ” ì˜ì¡´ì„± ì£¼ì… (DI: Dependency Injection)`ì´ë¼ í•œë‹¤.
  
### 3. ìƒì„±ì ì£¼ì… - OrderServiceImpl
hello.core.order > OrderServiceImpl.java (class)
````java
package hello.core.order;

import hello.core.discount.DiscountPolicy;
import hello.core.member.Member;
import hello.core.member.MemberRepository;

public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) { // ìƒì„±ì ì£¼ì…
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);

        return new Order(memberId, itemName, itemPrice, discountPrice);
    }
}
````
- ì„¤ê³„ ë³€ê²½ìœ¼ë¡œ `OrderServiceImpl`ì€ `FixDiscountPolicy`ë¥¼ ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë‹¨ì§€ `DiscountPolicy` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´
- `OrderServiceImpl` ì…ì¥ì—ì„œ ìƒì„±ìë¥¼ í†µí•´ ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ë“¤ì–´ì˜¬ì§€(ì£¼ì…ë ì§€)ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤.
- `OrderServiceImpl`ì˜ ìƒì„±ìë¥¼ í†µí•´ì„œ ì–´ë–¤ êµ¬í˜„ ê°ì²´ë¥¼ ì£¼ì…í• ì§€ëŠ” ì˜¤ì§ ì™¸ë¶€(`AppConfig`)ì—ì„œ ê²°ì •ëœë‹¤.
- `OrderServiceImpl`ì€ ì´ì œë¶€í„° `ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘`í•˜ë©´ ëœë‹¤.
- `OrderServiceImpl`ì—ëŠ” `MemoryMemberRepository`, `FixDiscountPolicy` ê°ì²´ì˜ ì˜ì¡´ê´€ê³„ê°€ ì£¼ì…

### 4. AppConfig ì‹¤í–‰
hello.core > MemberApp
````java
package hello.core;

import hello.core.member.Grade;
import hello.core.member.Member;
import hello.core.member.MemberService;

public class MemberApp {

    public static void main(String[] args) {
        AppConfig appConfig = new AppConfig();
        MemberService memberService = appConfig.memberService(); // AppConfig ì—°ê²°
        Member member = new Member(1L, "memberA", Grade.VIP);
        memberService.join(member);

        Member findMember = memberService.findMember(1L);
        System.out.println("find Member = " + findMember.getName());
        System.out.println("new member = " + member.getName());
    }
}
````
hello.core > OrderApp
````java
package hello.core;

import hello.core.member.Grade;
import hello.core.member.Member;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.order.Order;
import hello.core.order.OrderService;

public class OrderApp {

    public static void main(String[] args) {
        AppConfig appConfig = new AppConfig();
        MemberService memberService = appConfig.memberService(); // AppConfig ì—°ê²°
        OrderService orderService = appConfig.orderService(); // AppConfig ì—°ê²°

        Long memberId = 1L;
        Member member = new Member(memberId, "memberA", Grade.VIP);
        memberService.join(member);

        Order order = orderService.createOrder(memberId, "itemA", 10000);

        System.out.println("order = " + order); // toString() ë¥¼ í˜¸ì¶œ
        // System.out.println("order.calculatePrice = " + order.calculatePrice());
    }
}
````

### ğŸ’¡ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìˆ˜ì •
test > java > hello.core.member > MemberServiceTest.java (class)
````java
public class MemberServiceTest {

    MemberService memberService;

    @BeforeEach // í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ì— ë¬´ì¡°ê±´ ì‹¤í–‰
    public void beforeEach() {
        AppConfig appConfig = new AppConfig();
        memberService = appConfig.memberService();
    }
    
    @Test
    .
    .
}
````

test > java > hello.core.order > OrderServiceTest.java (class)
````java
public class OrderServiceTest {

    MemberService memberService;
    OrderService orderService;
    
    @BeforeEach
    public void beforeEach() {
        AppConfig appConfig = new AppConfig();
        memberService = appConfig.memberService();
        orderService = appConfig.orderService();
    }

    @Test
    .
    .
}
````
![Tests passed](https://user-images.githubusercontent.com/54324782/209416574-2deda2d8-f766-411e-891e-d77c54f7c6bf.png)

- - -
## âœ” AppConfig ë¦¬íŒ©í„°ë§
í˜„ì¬ AppConfigë¥¼ ë³´ë©´ `ì¤‘ë³µ`ì´ ìˆê³ , ì—­í• ì— ë”°ë¥¸ êµ¬í˜„ì´ ì˜ ì•ˆë³´ì¸ë‹¤.

- ë¦¬íŒ©í„°ë§ ì „
hello.core > AppConfig
````java
public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(new MemoryMemberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(new MemoryMemberRepository(), new FixDiscountPolicy());
    }
}
````

- ë¦¬íŒ©í„°ë§ í›„
````java
public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }
    
    public OrderService orderService() {
        return new OrderServiceImpl(memberRepository(), discountPolicy());
    }

    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }

    public DiscountPolicy discountPolicy() {
        return new FixDiscountPolicy();
    }
}
````
- `new MemoryMemberRepository()` ë¶€ë¶„ì´ ì¤‘ë³µ ì œê±°ë˜ì—ˆìœ¼ë¯€ë¡œ, ì´ì œ `MemoryMemberRepository`ë¥¼ ë‹¤ë¥¸ êµ¬í˜„ì²´ë¡œ ë³€ê²½í•  ë•Œ í•œ ë¶€ë¶„ë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤.
- `AppConfig`ë¥¼ ë³´ë©´ ì—­í• ê³¼ êµ¬í˜„ í´ë˜ìŠ¤ê°€ í•œëˆˆì— ë“¤ì–´ì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ êµ¬ì„±ì´ ì–´ë–»ê²Œ ë˜ì–´ìˆëŠ”ì§€ ë¹ ë¥´ê²Œ íŒŒì•…ì´ ê°€ëŠ¥


- - -
## âœ” ìƒˆë¡œìš´ êµ¬ì¡°ì™€ í• ì¸ ì •ì±… ì ìš©
- FixDiscountPolicy(ì •ì•¡ í• ì¸ ì •ì±…) --> RateDiscountPolicy(ì •ë¥ % í• ì¸ ì •ì±…)
- ì •ì±…ì„ ë³€ê²½í•´ë„ êµ¬ì„± ì˜ì—­ë§Œ ì˜í–¥ì„ ë°›ê³ , ì‚¬ìš© ì˜ì—­ì€ ì „í˜€ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤.
![í• ì¸ ì •ì±…ì˜ ë³€ê²½](https://user-images.githubusercontent.com/54324782/209417292-b6f5bf3c-323d-47c2-8f51-0749ff0d4ea7.png)

- hello.core > AppConfig
````java
public class AppConfig {
    .
    .
    public DiscountPolicy discountPolicy() {
        // return new FixDiscountPolicy();
        return new RateDiscountPolicy();
    }
}
````
- [í…ŒìŠ¤íŠ¸] hello.core > OrderApp.java
````java
// Order order = orderService.createOrder(memberId, "itemA", 10000);
Order order = orderService.createOrder(memberId, "itemA", 20000);
````
![í…ŒìŠ¤íŠ¸](https://user-images.githubusercontent.com/54324782/209417412-bf3c25c4-61dc-42a8-b51f-86cbb08876f9.png)

